---
title: Exercise solution for Chapter 2, Part 1
author: Sere Williams
date: '2020-02-19'
slug: exercise-solution-for-chapter-2
draft: yes
categories:
  - exercises
  - Chapter 2
tags:
  - exercises
  - Chapter 2
subtitle: ''
summary: ''
authors: [sere-williams]
lastmod: '2020-02-19T15:25:48-07:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>As always, load libraries first.</p>
<pre class="r"><code>library(ggplot2)
library(tidyverse)
library(dplyr)</code></pre>
<div id="exercise-2.3-from-modern-statistics-for-modern-biologists" class="section level2">
<h2>Exercise 2.3 from Modern Statistics for Modern Biologists</h2>
<p>A sequence of three nucleotides codes for one amino acid. There are 4 nucleotides, thus <span class="math inline">\(4^3\)</span> would allow for 64 different amino acids, however there are only 20 amino acids requiring only 20 combinations + 1 for an “end” signal. (The “start” signal is the codon, ATG, which also codes for the amino acid methionine, so the start signal does not have a separate codon.) The code is redundant. But is the redundancy even among codons that code for the same amino acid? In other words, if alanine is coded by 4 different codons, do these codons code for alanine equally (each 25%), or do some codons appear more often than others? Here we use the tuberculosis genome to explore codon bias.</p>
</div>
<div id="a-explore-the-data-mtb-using-table-to-tabulate-the-amacid-and-codon-variables." class="section level1">
<h1>a) Explore the data <code>mtb</code> using <code>table</code> to tabulate the <code>AmAcid</code> and <code>Codon</code> variables.</h1>
<p>Each amino acid is encoded by 1–6 tri-nucleotide combinations.</p>
<pre class="r"><code>mtb = read.table(&quot;example_datasets/M_tuberculosis.txt&quot;, header = TRUE)
codon_no &lt;- rowSums(table(mtb))
codon_no</code></pre>
<pre><code>## Ala Arg Asn Asp Cys End Gln Glu Gly His Ile Leu Lys Met Phe Pro Ser Thr Trp Tyr 
##   4   6   2   2   2   3   2   2   4   2   3   6   2   1   2   4   6   4   1   2 
## Val 
##   4</code></pre>
<p>The <code>PerThousands</code> of each codon can be visualized, where each plot represents an amino acid and each bar represents a different codon that codes for that amino acid. But what does the <code>PerThousands</code> variable mean?</p>
<pre class="r"><code>ggplot(mtb, aes(x=Codon, y=PerThous)) +
  geom_col()+
  facet_wrap(~AmAcid, scales=&quot;free&quot;) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="/post/2020-02-19-exercise-solution-for-chapter-2_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
</div>
<div id="b-how-was-the-perthous-variable-created" class="section level1">
<h1>b) How was the <code>PerThous</code> variable created?</h1>
<p>The sum of all of the numbers of codons gives you the total number of codons in the M. tuberculosis genome: <code>all_codons</code>. Remember that this is not the size of the M. tuberculosis genome, but the number of codons in all M. tuberculosis genes. To get the size of the genome, multiply each codon by 3 (for each nucleotide) and add all non-coding nucleotides (which we do not know from this data set).</p>
<pre class="r"><code>all_codons = sum(mtb$Number)
all_codons</code></pre>
<pre><code>## [1] 1344223</code></pre>
<p>The <code>PerThousands</code> variable is derived by dividing the number of occurrences of the codon of interest by the total number of codons. Because this number is small and hard to interpret, multiplying it by 1000 gives a value that is easy to make sense of. Here is an example for proline. The four values returned align to the four codons that each code for proline.</p>
<pre class="r"><code>pro  =  mtb[mtb$AmAcid == &quot;Pro&quot;, &quot;Number&quot;]
pro / all_codons * 1000</code></pre>
<pre><code>## [1] 31.560240  6.121752  3.405685 17.032144</code></pre>
</div>
<div id="c-write-an-r-function-that-you-can-apply-to-the-table-to-find-which-of-the-amino-acids-shows-the-strongest-codon-bias-i.e.-the-strongest-departure-from-uniform-distribution-among-its-possible-spellings." class="section level1">
<h1>c) Write an R function that you can apply to the table to find which of the amino acids shows the strongest codon bias, i.e., the strongest departure from uniform distribution among its possible spellings.</h1>
<p>First, let’s look at the expected frequencies of each codon.</p>
<pre class="r"><code>codon_expected &lt;- data.frame(codon_no) %&gt;%
  rownames_to_column() %&gt;%
  rename(`AmAcid` = rowname) %&gt;%
  mutate(prob_codon = 1/codon_no)
codon_expected</code></pre>
<pre><code>##    AmAcid codon_no prob_codon
## 1     Ala        4  0.2500000
## 2     Arg        6  0.1666667
## 3     Asn        2  0.5000000
## 4     Asp        2  0.5000000
## 5     Cys        2  0.5000000
## 6     End        3  0.3333333
## 7     Gln        2  0.5000000
## 8     Glu        2  0.5000000
## 9     Gly        4  0.2500000
## 10    His        2  0.5000000
## 11    Ile        3  0.3333333
## 12    Leu        6  0.1666667
## 13    Lys        2  0.5000000
## 14    Met        1  1.0000000
## 15    Phe        2  0.5000000
## 16    Pro        4  0.2500000
## 17    Ser        6  0.1666667
## 18    Thr        4  0.2500000
## 19    Trp        1  1.0000000
## 20    Tyr        2  0.5000000
## 21    Val        4  0.2500000</code></pre>
<p>Next, calculate the observed frequencies for each codon seen in the data set and use the chi-squared test statistic to determine if the difference between expected and observed codon frequencies is even or if some codon sequences are used more than others.</p>
<pre class="r"><code>codon_compared &lt;- mtb %&gt;% 
  group_by(AmAcid) %&gt;% 
  mutate(total = sum(Number),
         n_codons = n(),
         expected = total / n_codons)
codon_compared</code></pre>
<pre><code>## # A tibble: 64 x 7
## # Groups:   AmAcid [21]
##    AmAcid Codon Number PerThous  total n_codons expected
##    &lt;fct&gt;  &lt;fct&gt;  &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt;
##  1 Gly    GGG    25874    19.2  132810        4   33202.
##  2 Gly    GGA    13306     9.9  132810        4   33202.
##  3 Gly    GGT    25320    18.8  132810        4   33202.
##  4 Gly    GGC    68310    50.8  132810        4   33202.
##  5 Glu    GAG    41103    30.6   62870        2   31435 
##  6 Glu    GAA    21767    16.2   62870        2   31435 
##  7 Asp    GAT    21165    15.8   77852        2   38926 
##  8 Asp    GAC    56687    42.2   77852        2   38926 
##  9 Val    GTG    53942    40.1  114991        4   28748.
## 10 Val    GTA     6372     4.74 114991        4   28748.
## # … with 54 more rows</code></pre>
<pre class="r"><code>ggplot(codon_compared, aes(x=Codon, y=expected)) +
     geom_col()+
     facet_wrap(~AmAcid, scales=&quot;free&quot;) +
     theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="/post/2020-02-19-exercise-solution-for-chapter-2_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
<pre class="r"><code>codon_compared %&gt;% 
  filter(n_codons &gt; 1) %&gt;% 
  group_by(AmAcid) %&gt;% 
  mutate(chi_squared = ((Number - expected)^2/expected)) %&gt;% 
  summarise(chi_squared = sum(chi_squared),
            n = n()) %&gt;% 
  mutate(p_value = pchisq(chi_squared, df = n-1, log = TRUE, lower.tail = FALSE)) %&gt;% 
  arrange(p_value) %&gt;% 
  mutate(rank = 1:n())</code></pre>
<pre><code>## # A tibble: 19 x 5
##    AmAcid chi_squared     n p_value  rank
##    &lt;fct&gt;        &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;
##  1 Leu        135432.     6 -67700.     1
##  2 Ala         75620.     4 -37805.     2
##  3 Arg         72183.     6 -36076.     3
##  4 Thr         58767.     4 -29378.     4
##  5 Val         58737.     4 -29363.     5
##  6 Ile         56070.     3 -28035.     6
##  7 Gly         52534.     4 -26262.     7
##  8 Pro         45400.     4 -22695.     8
##  9 Ser         36742.     6 -18357.     9
## 10 Asp         16208.     2  -8109.    10
## 11 Phe         13444.     2  -6727.    11
## 12 Asn         11404.     2  -5707.    12
## 13 Gln          9376.     2  -4693.    13
## 14 Lys          6382.     2  -3195.    14
## 15 Glu          5947.     2  -2978.    15
## 16 His          5346.     2  -2678.    16
## 17 Tyr          4738.     2  -2373.    17
## 18 Cys          2958.     2  -1483.    18
## 19 End           928.     3   -464.    19</code></pre>
<p>As you may notice, these p-values are large, negative (so very tiny) values. In calculating the p-value from chi-squared text statistic, we took the log. If you exponentiate the p-value, you will get the actual p-value, but this number is so small (0.00000000e+00) that it is looses meaning. Instead, we will leave the p-value as a negative and sort the amino acids from most negative to less negative, providing a rank order of amino acids with the most unevenly used codons at 1 and amino acids with more evenly used codons as their rank increases.</p>
</div>
